'use strict';

angular.module('insight.amountStatistic').controller('AmountStatisticController',
  function($scope, $routeParams, $location, Global, AmountStatistic , config) {
    $scope.global = Global;
    $scope.getAmountStatistic = function(){
      AmountStatistic.get( {} , function( data ){
        /*
          显示币总量、                      29400000
          未挖出数量、		                  29400000 - 所有地址的余额
            流通数量、                      所有地址的余额 - (
					                                      黑洞地址[XagqqFetxiDb9wbartKDrXgnqLah6SqX2S]余额数量 , 
                                                安资销毁地址[XagqqFetxiDb9wbartKDrXgnqLah9fKoTx]余额数量 
                                            )
            锁定数量、                      所有地址的锁定余额 (到期后扣减，更新到流通数量中)
        真实流通数量、                      流通数量 - 锁定数量
主节点数量/抵押在主节点币数量、               rpc-masternodelist 返回节点列表并统计数量 /  数量 * 1000

        主节点已解锁交易数量                 就是主节点列表中交易，它已经解锁了，但依然作为主节点保持着
        未抵押和锁定数量                     真实流通量 - (已解锁交易数量 * 1000)

        */
        data.unminedAmount = data.totalAmount - data.totalAddressAmount;
        data.flowAmount    = data.totalAddressAmount - data.totalDestoryAmount;
        data.masternodeAmount = data.masternodeCount * 1000;

        // 未抵押和锁定数量  
        data.unlockedAndMortgageAmount = data.totalFlowAmount - ( data.masternodeUnlockTxCount * 1000 * Math.pow( 10 ,8 ) )

        var speed = config.spos.blockedSpeed;
        var reward = config.spos.blockedReward;
        var minitueSupply = 60 / speed ;
        var daySupply = minitueSupply * 60 * 24 ;
        var monthSupply = daySupply * 30;
        var yearSupply = monthSupply * 12;

        data.supply = {
          day: daySupply,
          dayAmount: daySupply * reward,
          month: monthSupply ,
          monthAmount: monthSupply * reward,
          year: yearSupply ,
          yearAmount: yearSupply * reward,
        };
        $scope.statistic = data;
      } )
    }
    $scope.formatNumber8 = function( num ){
      return  parseFloat(parseFloat(
          parseFloat(num) / Math.pow( 10 ,8 )
      ).toFixed(8));
    }
    $scope.amountformat = function( number ){
       /*
        * 参数说明：
        * number：要格式化的数字
        * decimals：保留几位小数
        * dec_point：小数点符号
        * thousands_sep：千分位符号
        * */
        const decimals = 2;
        number = (number + '').replace(/[^0-9+-Ee.]/g, '');
        var n = !isFinite(+number) ? 0 : +number,
            prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
            sep = ',',
            dec = '.',
            s = '',
            toFixedFix = function (n, prec) {
                var k = Math.pow(10, prec);
                return '' + Math.floor(n * k) / k;
            };
        s = (prec ? toFixedFix(n, prec) : '' + Math.floor(n)).split('.');
        var re = /(-?\d+)(\d{3})/;
        while (re.test(s[0])) {
            s[0] = s[0].replace(re, "$1" + sep + "$2");
        }
        if ((s[1] || '').length < prec) {
            s[1] = s[1] || '';
            s[1] += new Array(prec - s[1].length + 1).join('0');
        }
        return s.join(dec);
    }
  });
